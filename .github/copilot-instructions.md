This Terraform module generates standardized, validated naming conventions for Azure DevOps resources based on Microsoft's official [naming restrictions](https://learn.microsoft.com/en-us/azure/devops/organizations/settings/naming-restrictions?view=azure-devops). It provides both regular (`name`) and unique (`name_unique`) variants for each resource type.

1. **Main Resource Definitions** ([main.tf](main.tf)): `local.azdo` map contains all resource types with:

   - `name` / `name_unique`: Generated names using prefix/suffix patterns
   - `regex`: Microsoft's validation pattern for each resource type
   - `min_length` / `max_length`: Character constraints
   - `slug`: Short identifier for resource type
   - `scope`: Organization, Project, or Repository level

2. **Validation Layer** ([validation.tf](validation.tf)): Parallel `local.validation` map that validates each generated name against its regex and length constraints. Outputs boolean `valid_name` and `valid_name_unique` flags.

3. **Outputs** ([outputs.tf](outputs.tf)): Exposes complete resource objects including metadata for consumption by other modules.

- **Standard names**: `{prefix}-{resource-specific-parts}-{suffix}`
- **Unique names**: Append `{random}` (4-char default, configurable via `unique_length`)
- **Lowercase enforcement**: Git repository and branch names are always lowercased
- **Special cases**:
  - Environment resources use `for_each` over translated environment tags (e.g., `dev` → `development`)
  - Work item branches combine environment + work item ID (e.g., `feature/1234-dbmh-test`)
  - Branch naming supports both dash and slash separators (`*_dash` vs `*_slash` outputs)

The `local.environment_mapping` (lines 39-54 in [main.tf](main.tf)) translates short codes to full names:

```hcl
dev  → development
uat  → user-acceptance-testing
prd/prod → production
```

Always use these mappings for environment-based resources.

This repo uses **pre-commit hooks** extensively. Before making changes:

1. Install pre-commit: `brew install pre-commit` (macOS) or `pip install pre-commit`
2. Install hooks: `pre-commit install`
3. Hooks auto-run on `git commit`, including:
   - `terraform_validate`: Validates TF syntax
   - `terraform_fmt`: Formats code to HCL standards
   - `terraform-docs`: Auto-generates README documentation from code
   - `tflint`: Lints Terraform code
   - `cspell`: Spell-checks all files
   - `prettier`: Formats JSON/YAML/Markdown
   - MegaLinter (via GitHub Actions): Comprehensive linting on PR

**CRITICAL**: Do NOT manually edit Terraform sections in README.md between:

```markdown
<!-- start_of_terraform_docs -->

...

<!-- end_of_terraform_docs -->
```

Documentation is auto-generated by `terraform-docs` using:

- Config: `.config/.terraform-terraform-docs.yml` and `.config/.readme-terraform-docs.yml`
- Templates: `terraform-docs/tf_header.txt` and `terraform-docs/tf_footer.txt`
- Default values: `terraform-docs/default_values.json`

To regenerate docs: `pre-commit run terraform-docs -a`

1. **Validation**: Run `terraform validate` - this checks regex patterns in [validation.tf](validation.tf)
2. **Examples**: Test using [examples/example1/example.tf](examples/example1/example.tf) or example2
3. **Version updates**: Use `tfupdate` commands documented in README for provider version bumps
4. **Version management**: This repo uses `.terraform-version` file for tfenv/asdf compatibility

To run specific hooks manually:

```bash
pre-commit run --all-files

pre-commit run terraform-validate --all-files
pre-commit run terraform-docs --all-files
pre-commit run cspell --all-files
```

When adding a new Azure DevOps resource to [main.tf](main.tf):

1. Add to `local.azdo` map following existing pattern:

   ```hcl
   resource_name = {
     name        = substr(join("-", compact([local.prefix, "", local.suffix])), 0, max_length)
     name_unique = substr(join("-", compact([local.prefix, "", local.suffix_unique])), 0, max_length)
     dashes      = true
     slug        = "shortcode"
     min_length  = 1
     max_length  = <from MS docs>
     scope       = "Project|Organization|Repository"
     regex       = "^[allowed-chars]*$"  # from MS docs
   }
   ```

2. Add corresponding validation in [validation.tf](validation.tf):

   ```hcl
   resource_name = {
     valid_name        = length(regexall(local.azdo.resource_name.regex, local.azdo.resource_name.name)) > 0 && length(local.azdo.resource_name.name) > local.azdo.resource_name.min_length
     valid_name_unique = length(regexall(local.azdo.resource_name.regex, local.azdo.resource_name.name_unique)) > 0
   }
   ```

3. Add output in [outputs.tf](outputs.tf):
   ```hcl
   output "resource_name" {
     description = "The <description> in Azure DevOps"
     sensitive   = false
     value       = local.azdo.resource_name
   }
   ```

- Use list types for `prefix`/`suffix` to allow multi-part names: `["company", "project"]`
- `environment_tags` must validate against the approved list (see [variables.tf](variables.tf) line 6-8)
- `unique_seed` allows deterministic random generation for testing
- All variables have sensible defaults - module can be called with no arguments

Dynamic resources (environments, branches) use `for_each`:

- Single level: `for item in list : item => { ... }`
- Nested (work items): `for tag in envs : tag => { for item in items : item => { ... } }`

```hcl
module "azdo_naming" {
  source  = "DownAtTheBottomOfTheMoleHole/naming/azuredevops"
  version = ">= 6.0.0, <7.0.0"

  prefix = ["company-abbrev"]  # e.g., ["dbmh"]
  suffix = ["project-name"]
}

```

- Simple resources: `module.azdo_naming.project.name`
- Environment-based: `module.azdo_naming.environment["development"].name`
- Work item branches: `module.azdo_naming.git_repository_feature_branch_slash["1234"].name_unique`

1. **Slash validation**: Branch names with slashes (e.g., `feature/123`) may fail regex validation - use `_dash` variants instead
2. **Length truncation**: Names are auto-truncated with `substr()` - verify critical names aren't cut off
3. **Empty prefix/suffix**: `compact()` removes empty strings, but empty lists need explicit handling
4. **Unique seed persistence**: If using `unique_seed`, document it - otherwise random changes on each apply

- `main.tf`: All resource name generation logic (821 lines)
- `validation.tf`: Validation rules mirroring main.tf structure (348 lines)
- `outputs.tf`: Exposes all resources + validation results (396 lines)
- `variables.tf`: Input variables with validation
- `versions.tf`: Provider requirements (Terraform >=1.10.0, Random >=3.6.0)
- `examples/`: Working examples demonstrating usage patterns
- `.config/`: Configuration for linters, formatters, terraform-docs
