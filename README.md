# Down At The Bottom Of The Mole HoleTerraform module template

[![terraform_module_template][logo-image]](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template)

<!-- Github Badges -->
<!--
*** replace with badges relevant to your repo
-->

[![CAG Standard Terraform Module Pull Request](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/pullrequest.yml/badge.svg)](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/pullrequest.yml)

[![create new release](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/release.yml/badge.svg)](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/release.yml)

[![Nightly MegaLinter Scan of Full Codebase](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/nightly_mega-linter.yml/badge.svg)](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/nightly_mega-linter.yml)

[![Terraform Dependencies and Documentation](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/terraform_dependencies.yml/badge.svg)](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/actions/workflows/terraform_dependencies.yml)

<!-- Made With Badges -->
<!--
*** Replace with badges relevant to your repo
-->

<!-- Made Badge for latest version of terraform_module_template not currently working -->
<!--
[![GitHub release (latest SemVer)](https://img.shields.io/azure-devops/tag/DownAtTheBottomOfTheMoleHole/terraform_module_template?label=terraform_module_template)](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/tags)
-->

[![made%20with-Markdown](https://img.shields.io/badge/Made%20with-Markdown-1f425f.svg)](http://commonmark.org)
[![made%20with-MegaLinter](https://img.shields.io/badge/Made%20with-MegaLinter-1f425f.svg)](https://megalinter.io/latest/)
[![made%20with-PowerShell](https://img.shields.io/badge/Made%20with-PowerShell-1f425f.svg)](https://github.com/PowerShell/PowerShell)
[![made%20with-pre-commit](https://img.shields.io/badge/Made%20with-pre--commit-1f425f.svg)](https://github.com/pre-commit/pre-commit)
[![made%20with-terraform](https://img.shields.io/badge/Made%20with-Terraform-1f425f.svg)](https://www.gnu.org/software/bash/)

<!-- Precommit Badges -->
<!--
*** Replace with badges relevant to your repo
-->

these are the pre-commit hooks used for this repo:

[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=check-added-large-files)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=check-case-conflict)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=check-merge-conflict)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=check-json)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=check-yaml)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=detect-private-key)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=end-of-file-fixer)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/pre-commit/pre-commit-hooks?label=trailing-whitespace)](https://github.com/pre-commit/pre-commit-hooks/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/streetsidesoftware/cspell?label=CSpell)](https://github.com/streetsidesoftware/cspell/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/tag/pre-commit/mirrors-prettier?label=Prettier)](https://github.com/pre-commit/mirrors-prettier/tags)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=terraform_fmt)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=terraform_tflint)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=terraform_validate)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=terrascan)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=tfupdate)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/antonbabenko/pre-commit-terraform?label=infracost_breakdown)](https://github.com/antonbabenko/pre-commit-terraform/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/terraform-docs/terraform-docs?label=terraform-docs-go)](https://github.com/terraform-docs/terraform-docs/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/oxsecurity/megalinter?label=megalinter-incremental)](https://github.com/oxsecurity/megalinter/releases)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/mattlqx/pre-commit-sign?label=pre-commit-sign)](https://github.com/mattlqx/pre-commit-sign/releases)

<!-- TABLE OF CONTENTS -->

## Table of Contents

- [Down At The Bottom Of The Mole HoleTerraform module template](#down-at-the-bottom-of-the-mole-holeterraform-module-template)
  - [Table of Contents](#table-of-contents)
  - [About The Project](#about-the-project)
  - [Built With](#built-with)
- [Terraform](#terraform)
    - [Requirements](#requirements)
    - [Consuming Module\_Name](#consuming-module_name)
  - [Example 1](#example-1)
    - [Resources](#resources)
    - [Inputs](#inputs)
    - [Outputs](#outputs)
    - [Modules](#modules)
      - [Automatically generated Terraform variables](#automatically-generated-terraform-variables)
        - [Terraform versions](#terraform-versions)
        - [Installing Tfupdate](#installing-tfupdate)
        - [Terraform version](#terraform-version)
        - [Azure Naming module version](#azure-naming-module-version)
        - [AWS version](#aws-version)
        - [AzureAD version](#azuread-version)
        - [AzureDevOps version](#azuredevops-version)
        - [AzureRm version](#azurerm-version)
        - [Random version](#random-version)
        - [Time version](#time-version)
  - [terraform\_module\_template Usage](#terraform_module_template-usage)
    - [Creating your own terraform module using terraform\_module\_template](#creating-your-own-terraform-module-using-terraform_module_template)
    - [Backfitting terraform\_module\_template to an existing module](#backfitting-terraform_module_template-to-an-existing-module)
  - [Roadmap](#roadmap)
  - [Contributing](#contributing)
    - [Contributing Prerequisites](#contributing-prerequisites)
  - [License](#license)
  - [Contact](#contact)

<!-- ABOUT THE PROJECT -->

## About The Project

This is a repository template to be used for all of 
Down At The Bottom Of The Mole Hole's Terraform modules.

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

## Built With

- [cspell](https://github.com/streetsidesoftware/cspell-cli)
- [GitVersion](https://github.com/GitTools/GitVersion)
- [Infracost](https://github.com/infracost/infracos)
- [Markdown](https://www.markdownguide.org/)
- [Mermaid](https://mermaid.live/)
- [Pre-Commit](https://pre-commit.com/)
- [pre-commit-terraform](https://github.com/antonbabenko/pre-commit-terraform)
- [prettier](https://github.com/prettier/prettier)
- [Terraform](https://www.terraform.io/)
- [Terraform-docs](https://github.com/terraform-docs/terraform-docs)
- [Terrascan](https://github.com/tenable/terrascan)
- [tflint](https://github.com/terraform-linters/tflint)
- [tfsec](https://github.com/aquasecurity/tfsec)
- [tfupdate](https://github.com/minamijoyo/tfupdate)

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- Terraform -->
<!-- markdownlint-disable -->
<!-- markdown-table-prettify-ignore-start -->
<!-- prettier-ignore-start -->
<!-- start_of_terraform_docs -->
# Terraform

The below documentation was generated via Terraform docs using pre-commit

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | 1.7.5 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | 5.42.0 |
| <a name="requirement_azuread"></a> [azuread](#requirement\_azuread) | 2.47.0 |
| <a name="requirement_azuredevops"></a> [azuredevops](#requirement\_azuredevops) | 1.0.1 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | 3.97.1 |
| <a name="requirement_mongodbatlas"></a> [mongodbatlas](#requirement\_mongodbatlas) | 1.15.2 |
| <a name="requirement_random"></a> [random](#requirement\_random) | 3.6.0 |
| <a name="requirement_time"></a> [time](#requirement\_time) | 0.11.1 |

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- consuming Module_Name -->
### Consuming Module_Name

To consume this module add the following to your module.tf:
```hcl
module "Module_Name" {
	 source  = "github.com/DownAtTheBottomOfTheMoleHole/Module_Name.git"

	 # Required variables
	 application_name  = 
	 application_shortname  = 
	 azdo_pat  = 
	 azdo_project_name  = 
	 azdo_repo_name  = 
	 cag_division  = 
	 environment_tag  = 
	 resource_group_name  = 

	 # Optional variables
	 aws_access_key  = ""
	 aws_profile  = ""
	 aws_resource_location  = "eu-west-1"
	 aws_secret_key  = ""
	 azdo_orgurl  = null
	 azrm_client_id  = null
	 azrm_client_secret  = null
	 azrm_keyvault_whitelist  = []
	 azrm_resource_location  = "northeurope"
	 azrm_storage_whitelist  = []
	 azrm_subscription_id  = null
	 azrm_tenant_id  = null
	 default_tags  = {}
	 time_secret_expiry  = 100
	 time_spn_expiry  = 100
}
```

## Example 1

```hcl
##### Put your example Terraform code in this file and it will be displayed in the read me. ######
```

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Resources

| Name | Type |
|------|------|
| [random_password.aws_pass](https://registry.terraform.io/providers/hashicorp/random/3.6.0/docs/resources/password) | resource |
| [random_password.azure_pass](https://registry.terraform.io/providers/hashicorp/random/3.6.0/docs/resources/password) | resource |
| [time_offset.secret_expiry](https://registry.terraform.io/providers/hashicorp/time/0.10.0/docs/resources/offset) | resource |
| [time_offset.spn_password_expiry](https://registry.terraform.io/providers/hashicorp/time/0.10.0/docs/resources/offset) | resource |
| [azuread_client_config.bootstrap](https://registry.terraform.io/providers/hashicorp/azuread/2.47.0/docs/data-sources/client_config) | data source |
| [azuread_group.bootstrap](https://registry.terraform.io/providers/hashicorp/azuread/2.47.0/docs/data-sources/group) | data source |
| [azuredevops_project.bcaapp](https://registry.terraform.io/providers/microsoft/azuredevops/0.11.0/docs/data-sources/project) | data source |
| [azuredevops_project.bootstrap](https://registry.terraform.io/providers/microsoft/azuredevops/0.11.0/docs/data-sources/project) | data source |
| [azurerm_client_config.bootstrap](https://registry.terraform.io/providers/hashicorp/azurerm/3.94.0/docs/data-sources/client_config) | data source |
| [azurerm_subscription.bcaapp](https://registry.terraform.io/providers/hashicorp/azurerm/3.94.0/docs/data-sources/subscription) | data source |
| [azurerm_subscription.bootstrap](https://registry.terraform.io/providers/hashicorp/azurerm/3.94.0/docs/data-sources/subscription) | data source |

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_application_name"></a> [application\_name](#input\_application\_name) | Project/application name | `string` | n/a | yes |
| <a name="input_application_shortname"></a> [application\_shortname](#input\_application\_shortname) | short version of project/application name | `string` | n/a | yes |
| <a name="input_azdo_pat"></a> [azdo\_pat](#input\_azdo\_pat) | Azure Devops Personal Access token (can be set to system.accesstoken) | `string` | n/a | yes |
| <a name="input_azdo_project_name"></a> [azdo\_project\_name](#input\_azdo\_project\_name) | azure devops project name | `string` | n/a | yes |
| <a name="input_azdo_repo_name"></a> [azdo\_repo\_name](#input\_azdo\_repo\_name) | The name of the Azure Devops Git Repository your code resides in | `string` | n/a | yes |
| <a name="input_cag_division"></a> [cag\_division](#input\_cag\_division) | Division of CAG 3 character abbreviation e.hg. BCA, MMG | `string` | n/a | yes |
| <a name="input_environment_tag"></a> [environment\_tag](#input\_environment\_tag) | Environment tag e.g. dev, test, systest, UAT, Prod | `string` | n/a | yes |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | Specifies the name of the existing resource group to be used for the service plan | `string` | n/a | yes |
| <a name="input_aws_access_key"></a> [aws\_access\_key](#input\_aws\_access\_key) | AWS access key | `string` | `""` | no |
| <a name="input_aws_profile"></a> [aws\_profile](#input\_aws\_profile) | AWS profile | `string` | `""` | no |
| <a name="input_aws_resource_location"></a> [aws\_resource\_location](#input\_aws\_resource\_location) | Resource location. Must be a valid AWS region | `string` | `"eu-west-1"` | no |
| <a name="input_aws_secret_key"></a> [aws\_secret\_key](#input\_aws\_secret\_key) | AWS secret key | `string` | `""` | no |
| <a name="input_azdo_orgurl"></a> [azdo\_orgurl](#input\_azdo\_orgurl) | short version of project/application name | `string` | `null` | no |
| <a name="input_azrm_client_id"></a> [azrm\_client\_id](#input\_azrm\_client\_id) | Service principal id - cannot be null if working with azure | `string` | `null` | no |
| <a name="input_azrm_client_secret"></a> [azrm\_client\_secret](#input\_azrm\_client\_secret) | Service principal password - cannot be null if working with azure | `string` | `null` | no |
| <a name="input_azrm_keyvault_whitelist"></a> [azrm\_keyvault\_whitelist](#input\_azrm\_keyvault\_whitelist) | List of IP addresses and CIDR blocks for Key Vault whitelist to be combined with the defaults in main.tf | `list(string)` | `[]` | no |
| <a name="input_azrm_resource_location"></a> [azrm\_resource\_location](#input\_azrm\_resource\_location) | Resource group location. Must be a valid azure region | `string` | `"northeurope"` | no |
| <a name="input_azrm_storage_whitelist"></a> [azrm\_storage\_whitelist](#input\_azrm\_storage\_whitelist) | List of IP addresses and CIDR blocks for storage account whitelist to be combined with the defaults in main.tf | `list(string)` | `[]` | no |
| <a name="input_azrm_subscription_id"></a> [azrm\_subscription\_id](#input\_azrm\_subscription\_id) | Azure subscription id - cannot be null if working with azure | `string` | `null` | no |
| <a name="input_azrm_tenant_id"></a> [azrm\_tenant\_id](#input\_azrm\_tenant\_id) | Azure tenant id. cannot be null if working with Azure | `string` | `null` | no |
| <a name="input_default_tags"></a> [default\_tags](#input\_default\_tags) | Default map of tags to be applied to all resources generated by this module. | `map(string)` | `{}` | no |
| <a name="input_time_secret_expiry"></a> [time\_secret\_expiry](#input\_time\_secret\_expiry) | Number of years from now when keyvault secrets should expire | `number` | `100` | no |
| <a name="input_time_spn_expiry"></a> [time\_spn\_expiry](#input\_time\_spn\_expiry) | Number of years from now when service principal password should expire | `number` | `100` | no |

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Outputs

| Name | Description | Value | Sensitive |
|------|-------------|-------|:---------:|
| <a name="output_application_name"></a> [application\_name](#output\_application\_name) | The project/application name for this repository | `"application_name"` | no |
| <a name="output_application_shortname"></a> [application\_shortname](#output\_application\_shortname) | The shortened project/application name for this repository | `"application_shortname"` | no |
| <a name="output_aws_access_key"></a> [aws\_access\_key](#output\_aws\_access\_key) | The AWS Access Key | `<sensitive>` | yes |
| <a name="output_aws_profile"></a> [aws\_profile](#output\_aws\_profile) | The AWS profile used | `"aws_profile"` | no |
| <a name="output_aws_resource_location"></a> [aws\_resource\_location](#output\_aws\_resource\_location) | The AWS region used for the resources | `"eu-west-1"` | no |
| <a name="output_azdo_orgurl"></a> [azdo\_orgurl](#output\_azdo\_orgurl) | The Azure DevOps URL used for this run | `"https://dev.azure.com/bcagroup"` | no |
| <a name="output_azdo_pat"></a> [azdo\_pat](#output\_azdo\_pat) | The Azure DevOps Personal Access Token (PAT) used for this run | `<sensitive>` | yes |
| <a name="output_azrm_client_id"></a> [azrm\_client\_id](#output\_azrm\_client\_id) | The ID of the service principal used for this run | `"azrm_client_id"` | no |
| <a name="output_azrm_resource_location"></a> [azrm\_resource\_location](#output\_azrm\_resource\_location) | The location of resources being worked on with this run | `"northeurope"` | no |
| <a name="output_azure_subscription_display_name"></a> [azure\_subscription\_display\_name](#output\_azure\_subscription\_display\_name) | The current subscription name | `"subscription_display_name"` | no |
| <a name="output_azure_subscription_id"></a> [azure\_subscription\_id](#output\_azure\_subscription\_id) | The current subscription id | `"subscription_id"` | no |
| <a name="output_azuredevops_project_name"></a> [azuredevops\_project\_name](#output\_azuredevops\_project\_name) | The current Azure DevOps name | `"project_name"` | no |
| <a name="output_environment"></a> [environment](#output\_environment) | The environment being worked on with this run | `"dev"` | no |
| <a name="output_tags"></a> [tags](#output\_tags) | The tags applied to resources as part of this run | <pre>{<br>  "ADO-Project": "project_name",<br>  "Application": "application_name",<br>  "Environment": "dev",<br>  "Managed-By": "Terraform",<br>  "Owner": "project_name Contributors",<br>  "Repository": "repo_name"<br>}</pre> | no |
| <a name="output_tenant_id"></a> [tenant\_id](#output\_tenant\_id) | The azure tenant id of resources being worked on with this run | `"tenant_id"` | no |

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_azrm_naming"></a> [azrm\_naming](#module\_azrm\_naming) | Azure/naming/azurerm | 0.4.1 |

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

#### Automatically generated Terraform variables

This project uses terraform-docs to automatically generate tfvar files per environment that will allow you to have per environment values as well as common values.

the common values will reside in:

for the terraform directory (the terraform directory the pipelines  refer to): `.\environment\default.tfvars`

Environment specific variables then reside in an environment specific folder under the terraform directory e.g. `.\environment\dev\variables.tfvars`

to generate these files do the following

   1. Navigate to your terraform directory using command prompt or powershell
   2. To generate environment specific variables run `terraform-docs tfvars hcl . --output-file .\environment\poc\variables.tfvars --output-mode inject --read-comments --description --header-from ./terraform-docs/tf_header.txt --footer-from ./terraform-docs/tf_footer.txt` replacing the environment foldername as appropriate
   3. To generate the common variables file run `terraform-docs tfvars hcl . --output-file .\environment\default.tfvars --output-mode inject --read-comments --description --header-from ./terraform-docs/tf_header.txt --footer-from ./terraform-docs/tf_footer.txt`

##### Terraform versions

Terraform version and terraform provider versions have been set using tfupdate.
In order to update the installed providers to the latest versions please first install tfupdate using the below instructions and then run the following commands from the root of the repo in a powershell session. Please only run the commands for the providers/modules you are using.

##### Installing Tfupdate

the tfupdate repo can be found [here](https://github.com/minamijoyo/tfupdate)

either download the tarball and add tfupdate.exe to your PATH or do the following:

1. Ensure you have [Go](https://go.dev/doc/install) installed
2. Clone the repository locally `git clone https://github.com/minamijoyo/tfupdate.git`
3. build the source code with `go build`
4. Add the complied binaries to your PATH

##### Terraform version

```shell
tfupdate terraform . --version ">=$(tfupdate release latest hashicorp/terraform)" --recursive
```

please also add the terraform version to the `terraform_installer_version` variable in `build/pipelines/iac_templates/variables.yml`

##### Azure Naming module version

```shell
tfupdate module Azure/naming/azurerm . --version ">=$(tfupdate release latest Azure/naming/azurerm --source-type tfregistryModule)" --recursive
```

##### AWS version

```shell
tfupdate provider aws . --version ">=$(tfupdate release latest hashicorp/aws --source-type tfregistryProvider)" --recursive
```

##### AzureAD version

```shell
tfupdate provider azuread . --version ">=$(tfupdate release latest hashicorp/azuread --source-type tfregistryProvider)" --recursive
```

##### AzureDevOps version

```shell
tfupdate provider azuredevops . --version ">=$(tfupdate release latest microsoft/azuredevops --source-type tfregistryProvider)" --recursive
```

##### AzureRm version

```shell
tfupdate provider azurerm . --version ">=$(tfupdate release latest hashicorp/azurerm --source-type tfregistryProvider)" --recursive
```

##### Random version

```shell
tfupdate provider random . --version ">=$(tfupdate release latest hashicorp/random --source-type tfregistryProvider)" --recursive
```

##### Time version

```shell
tfupdate provider time . --version ">=$(tfupdate release latest hashicorp/time --source-type tfregistryProvider)" --recursive
```

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---
<!-- end_of_terraform_docs -->
<!-- markdownlint-enable -->
<!-- prettier-ignore-end -->
<!-- markdown-table-prettify-ignore-end -->

<!-- usage -->

## terraform_module_template Usage

Below are instructions on how to using the terraform module template to create
a new module or to apply to a pre-existing module.

### Creating your own terraform module using terraform_module_template

1. [browse to RolfMoleman organisation on github and create a new repository](https://github.com/organizations/DownAtTheBottomOfTheMoleHole/repositories/new)

2. Choose the Repository template as **RolfMoleman/terraform_module_template**

3. Leave the owner as **RolfMoleman**

4. Give the repository a name following the naming convention of
  `terraform-<provider name>-<resource name replacing spaces with ->`
    _Note:_ this will be the name of the module

5. Give the repository a meaningful concise description

6. Leave the repository visibility as private

7. clone your newly created repository using `git clone https://github.com/DownAtTheBottomOfTheMoleHole/Module_Name.git`

8. Create your readme:

9. In your vscode terminal do the following:

    1. `Rename-Item -Path ".\README.md" -NewName "README.OLD"`

    2. `Rename-Item -Path ".\BLANK_README.md" -NewName "README.md"`

10. In the new README.md do the following:

    1. Find & replace (CTRL+SHIFT+H in vs code) `Module_Name`
       with your module name.
       _Note:_ **Please** use snake_case e.g. azurerm_awesome_module

    2. Find and replace (CTRL+SHIFT+H in vs code) `Your_Email_Address`
       with your email address e.g. `carl.dawson@bca.com`

    3. Find and replace (CTRL+SHIFT+H in vs code) `Your_Team`
       with the name of your team

    4. Find and replace (CTRL+SHIFT+H in vs code) `Team_Email_List`
       with a comma separated list of your team member's email addresses

    5. Find and replace (CTRL+SHIFT+H in vs code) `Team_Email_Address`
       with your team's email address if you have one, else remove it.

    6. Find and replace (CTRL+SHIFT+H in vs code) `Module_Title`
       with a sensible name
       e.g. `
Down At The Bottom Of The Mole Hole Terraform module template`

    7. Find and replace (CTRL+SHIFT+H in vs code) `Module_Description`
       with some details about what the module is and what it is for

    8. Find and replace (CTRL+SHIFT+H in vs code) `Your_Name`
       with your name e.g. `Carl Dawson`

11. Update the roadmap so other staff can see your progress

12. Start creating/editing your terraform files - **Note:**
    use tflint to help you remove unneeded variables, outputs, resources & locals.
    This will also help ensure you have good descriptions, sensitive flags set etc.
    use validation on input variables where possible.

13. Generate your default_values.json
    this is a json file that populates your values in your documentation with
    actual values. You can either do this manually or
    by running `terraform output --json > default_values.json`
    once you have done a successful plan and apply.

14. Use [terraform-docs] to generate your documentation.
    1. README.md

       either run:

       ```shell
       terraform-docs markdown table . --config '.config\.readme-terraform-docs.yml'
       ```

       or:

       ```shell
       pre-commit run terraform-docs-go
       ```

    2. TERRAFORM.md

       either run:

       ```shell
       terraform-docs markdown table . --config '.config\.terraform-terraform-docs.yml'
       ```

       or:

       ```shell
       pre-commit run terraform-docs-go
       ```

15. Create a really useful module!

16. Tag your finished code using [GitVersion] - powershell one liner to do so:
    `$gitversion = (gitversion |ConvertFrom-Json);git tag $GitVersion.SemVer -m
     'My awesome release';git push --tags`

17. Push your finished code up to github
    _Note:_ dont forget to push your tags as well with `git push --tags`

18. The rest of CAG can consume your module :clap:

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

### Backfitting terraform_module_template to an existing module

1. Clone the terraform module template using
   `git clone https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template.git`

2. rename your existing README.md using
   `Rename-Item -Path ".\README.md" -NewName "README.OLD"`

3. copy the following basic directories from the template to the root of your repo
   1. .assets
   2. .config
   3. .github
   4. .infracost
   5. .pre-commit_logs - you may need to create this
   6. scripts
   7. terraform-docs

4. copy the following files from the template to the root of your repo
   1. LICENSE
   2. .gitignore - replace your own or merge them.
   3. .tflint.hcl
   4. BLANK_README.md - we will rename this later to become your new readme
   5. CODE_OF_CONDUCT.md
   6. TERRAFORM.md
   7. .prettierignore
   8. .pre-commit-config.yml

5. merge the .tf files from the template with your own to achieve the following structure
   1. main.tf - contains the core resources and locals
      use tflint to help you remove unneeded resources and locals.
   2. data.tf - contains any data sources your module requires
      use tflint to help you remove unneeded data sources.
   3. modules.tf - contains any external modules you may be calling.
      use tflint to help you remove unneeded modules.
   4. outputs.tf - contains all your module outputs.
      use tflint to help you remove unneeded outputs.
   5. variables.tf - contains your input variables.
      Please ensure you use our standard inputs to ensure consistency.
      use tflint to help you remove unneeded variables.
   6. versions.tf - contains the required versions for terraform and required providers.
      you must use the latest possible versions.
      You must be No more than 3 minor versions out of date.

6. update the `./terraform-docs/default_values.json`
   this must match the your terraform outputs in json format.
   this is a json file that populates your values in your documentation with
    actual values. You can either do this manually or
    by running `terraform output --json > default_values.json`
    once you have done a successful plan and apply.

7. create your readme from BLANK_README.md
   1. Find & replace (CTRL+SHIFT+H in vs code) `Module_Name`
       with your module name.
       _Note:_ **Please** use snake_case e.g. azurerm_awesome_module

   2. Find and replace (CTRL+SHIFT+H in vs code) `Your_Email_Address`
       with your email address e.g. `carl.dawson@bca.com`

   3. Find and replace (CTRL+SHIFT+H in vs code) `Your_Team`
       with the name of your team

   4. Find and replace (CTRL+SHIFT+H in vs code) `Team_Email_List`
       with a comma separated list of your team member's email addresses

   5. Find and replace (CTRL+SHIFT+H in vs code) `Team_Email_Address`
       with your team's email address if you have one, else remove it.

   6. Find and replace (CTRL+SHIFT+H in vs code) `Module_Title`
       with a sensible name
       e.g. `Down At The Bottom Of The Mole Hole Terraform module template`

   7. Find and replace (CTRL+SHIFT+H in vs code) `Module_Description`
       with some details about what the module is and what it is for

   8. Find and replace (CTRL+SHIFT+H in vs code) `Your_Name`
       with your name e.g. `Carl Dawson`

   9. Update the roadmap so other staff can see your progress

   10. rename BLANK_README.md to README.md using:
       1. `Rename-Item -Path ".\BLANK_README.md" -NewName "README.md"`

8. Use [terraform-docs] to generate your documentation.
    1. README.md

       either run:

       ```shell
       terraform-docs markdown table . --config '.config\.readme-terraform-docs.yml'
       ```

       or:

       ```shell
       pre-commit run terraform-docs-go
       ```

    2. TERRAFORM.md

       either run:

       ```shell
       terraform-docs markdown table . --config '.config\.terraform-terraform-docs.yml'
       ```

       or:

       ```shell
       pre-commit run terraform-docs-go
       ```

9. Create a really useful module!

10. Tag your finished code using [GitVersion] - powershell one liner to do so:
    `$gitversion = (gitversion |ConvertFrom-Json);git tag $GitVersion.SemVer -m
     'My awesome release';git push --tags`

11. Push your finished code back to your source control
    _Note:_ dont forget to push your tags as well with `git push --tags`

12. Anyone can consume your module :clap:

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- ROADMAP -->

## Roadmap

- [x] Basic template
- [x] Finish readme guide
- [x] Refine BLANK_README.md
- [x] Terraform-docs config per output markdown file :toolbox:
- [x] Basic GitHub actions
- [x] GitHub Issue Templates :toolbox:
- [x] GitHub Pull Request Template :toolbox:
- [x] Automated releases on push/merge/rebase to main :champagne: :toolbox: :dog::cut_of_meat:
- [ ] Consolidate workflows
- [x] Auto add issues to Platform & Automation backlog :champagne: :toolbox: :dog::cut_of_meat:
- [x] Megalinter automatic fixes via pull request :toolbox: :dog::cut_of_meat:
- [x] Dependabot automated dependency management :toolbox: :dog::cut_of_meat:
- [x] Renovate automated dependency management :toolbox: :dog::cut_of_meat:
- [x] Automated issue assignment to the Platform and Automation team :toolbox: :dog::cut_of_meat:
- [x] Add instructions on how to backfit the template :toolbox: :dog::cut_of_meat:

See the [issues][issues] for a full list of proposed features (and known issues).

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- CONTRIBUTING -->

## Contributing

**Everyone is encouraged to contribute**
Contributions are what make the open source community such a great way to learn,
inspire, and create.
Any contributions you make are **greatly appreciated**.

If you have a suggestion that would make this better, please create a branch and
create a pull request. You can also simply open an issue with the tag "enhancement".

Don't forget to give the project a star! Thanks again!

1. Clone the Repo (`git clone https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template`)
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

---

**NOTE:** This repo has tagged releases where the version  is generated by gitversion.
You can increment the release version by adding to your commit message as follows:

Adding +semver: breaking or +semver: major will cause the major version to be increased,
+semver: feature or +semver: minor will bump minor and +semver: patch
or +semver: fix will bump the patch.
[source][gitversion_website]

---

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

To work with this repo we recommend you install the tools
that are included in the prerequisites.
However, you may work on the repo in the browser if you prefer.

### Contributing Prerequisites

To replicate the setup used to initially create this repository you will need

1. Clone the Repo

   ```sh
   git clone https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template.git
   ```

2. Install Chocolatey

   ```powershell
   Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
   ```

3. Install Node

   ```cmd
   choco install nodejs
   ```

4. Install Terraform

   ```cmd
   choco install terraform
   ```

5. Install TFlint

   ```cmd
   choco install tflint
   ```

   Also download the tflint plugins from github such as
   [tflint-ruleset-azurerm][tflint-ruleset-azurerm] and [tflint-ruleset-aws][tflint-ruleset-aws]
   put these  in your `.tflint.d/plugins` directory at the root of your user directory

6. Install terraform-docs

   ```cmd
   choco install terraform-docs
   ```

7. Install Python

   ```cmd
   choco install python
   ```

8. Install pip

   ```cmd
   curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
   python get-pip.py
   ```

9. Install pre-commit

   ```cmd
   pip install pre-commit
   ```

10. Install vscode

    ```cmd
    choco install vscode
    ```

11. Install tfupdate

Download the latest compiled binaries from [here][tfupdate_releases]
then put it in your executable path.

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- LICENSE -->

## License

for more information about the license please see [LICENSE.md]

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- CONTACT -->

## Contact

RolfMoleman - @RolfMoleman

Module Link: [https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template](https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template)

---

<!-- Readme Navigation -->

[(Back to the Table of Contents)](#table-of-contents)

---

<!-- MARKDOWN LINKS & IMAGES -->
<!-- https://www.markdownguide.org/basic-syntax/#reference-style-links -->

<!-- URLs -->

[gitversion_website]: https://gitversion.net/docs/reference/version-increments
[terraform-docs]: https://terraform-docs.io
[issues]: https://github.com/DownAtTheBottomOfTheMoleHole/terraform_module_template/issues
[tfupdate_releases]: https://github.com/minamijoyo/tfupdate/releases

[tflint-ruleset-aws]: https://github.com/terraform-linters/tflint-ruleset-aws/releases
[tflint-ruleset-azurerm]: https://github.com/terraform-linters/tflint-ruleset-azurerm/releases

<!-- IMAGES AND ICONS -->

[logo-image]: ./.assets/RolfMoleman.png

<!-- FILE LINKS -->
[LICENSE.md]: ./LICENSE.md